---
sidebar_position: 3
hide_table_of_contents: false
---
import Image from '@theme/IdealImage';
import BrowserVideo from '@site/src/components/BrowserVideo';

# Ejemplo. Formularios con n8n.

## Enunciado
### En el IES Alonso de Ercilla, las incidencias de las aulas se registran en formularios en papel. Con el fin de agilizar su gesti√≥n, se plantea la digitalizaci√≥n de estos documentos mediante OCR, permitiendo que la informaci√≥n llegue de forma autom√°tica a un sistema digital de control de incidencias.

## Videotutoriales
En este apartado podr√°s ver todo el proceso del desarrollo del proyecto.
### V√≠deo 1. Instalaci√≥n
 En este v√≠deo aprender√°s paso a paso a instalar <strong>n8n</strong>, una potente herramienta de automatizaci√≥n. 
Configuraremos <strong>Node.js</strong> en Windows, ejecutaremos n8n desde la consola y prepararemos su despliegue con <strong>Docker</strong>.

<BrowserVideo url="https://www.youtube.com/watch?v=RSKeZlUXjJk" />

### V√≠deo 2. Env√≠o automatizado de correos con Gmail y N8N
En este v√≠deo aprenderemos a enviar correos autom√°ticos con Gmail usando N8N, una herramienta de automatizaci√≥n. Veremos c√≥mo generar la contrase√±a de aplicaci√≥n de Google, configurar un flujo en N8N que reciba peticiones HTTP, y probarlo con Postman para enviar correos personalizados con asunto y mensaje desde un JSON. Ideal para entender c√≥mo conectar servicios y automatizar tareas reales.

<BrowserVideo url="https://www.youtube.com/watch?v=wT9G4iYpgIU" />


### V√≠deo 3 Digitalizaci√≥n autom√°tica de incidencias con OCR, Google Forms y n8n (Parte 1)
En este v√≠deo se explica c√≥mo transformar incidencias escritas a mano en formularios digitales de manera autom√°tica. A partir de una imagen o escaneo, se utiliza tecnolog√≠a OCR para extraer el texto y generar un archivo JSON con los datos. Despu√©s, se muestra c√≥mo crear un formulario en Google Forms con los campos ‚Äúnombre‚Äù, ‚Äúlugar‚Äù y ‚Äúdetalle‚Äù, y c√≥mo enviarle informaci√≥n mediante una petici√≥n HTTP POST usando Postman. Este proceso sienta las bases para automatizar el flujo completo con n8n, que se abordar√° en la siguiente parte del tutorial.
<BrowserVideo url="https://www.youtube.com/watch?v=1R5dFzwpdwA" />

### V√≠deo 4 Digitalizaci√≥n autom√°tica de incidencias con OCR, Google Forms y n8n (Parte 2)

<BrowserVideo url="https://www.youtube.com/watch?v=DrqBUgv36XA" />


### V√≠deo 5 Digitalizaci√≥n autom√°tica de incidencias con OCR, Google Forms y n8n (Parte 3)

<BrowserVideo url="https://www.youtube.com/watch?v=MKTu9jwtwp4" />


### V√≠deo 6 Digitalizaci√≥n autom√°tica de incidencias con OCR, Google Forms y n8n (Parte 4)
En este v√≠deo se explica como realizar la conexi√≥n con DropBox.

<BrowserVideo url="https://www.youtube.com/watch?v=lQwAr1G1yNg" />




## Ejemplo de formularios


<div style={{
  display: 'grid',
  gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
  gap: '1rem'
}}>
  <img src="/img/n8n/i0.png" alt="img0" />
  <img src="/img/n8n/i1.png" alt="img1" />
  <img src="/img/n8n/i2.png" alt="img2" />
  <img src="/img/n8n/i3.png" alt="img3" />
  <img src="/img/n8n/i4.png" alt="img4" />
  <img src="/img/n8n/i5.png" alt="img5" />
</div>




## SECUENCIA DE DATOS
<figure>
  <img src="/img/n8n/Formulario.png" alt="formulario" width="800" />
</figure>

## SECUENCIA DE DATOS (Con DropBox)
<figure>
  <img src="/img/n8n/formulario2.png" alt="formulario2" width="800" />
</figure>


## C√ìDIGO BASE PARA EL PROGRAMA
1. Crea un nuevo proyecto llamado `Incidencias` desde el IDE IntelliJ IDEA en Maven.
2. A√±ade las siguientes dependencias en el archivo `pom.xml`: 
      
**OkHttp (para las peticiones HTTP)**
```xml
<dependency>
    <groupId>com.squareup.okhttp3</groupId>
    <artifactId>okhttp</artifactId>
    <version>4.12.0</version>
</dependency>
```

**org.json (para parsear y construir JSON)**

```xml
<dependency>
  <groupId>org.json</groupId>
  <artifactId>json</artifactId>
  <version>20231013</version>
</dependency>
```

**librer√≠a dotenv-java (seguridad para claves en control de versiones)**

```xml
<dependency>
  <groupId>io.github.cdimascio</groupId>
  <artifactId>dotenv-java</artifactId>
  <version>3.0.0</version>
</dependency>

```


:::warning ATENCI√ìN
1. Al poner las dependencias deben ir en el nodo `<dependencies></dependencies>` (a√±√°delo si no est√°).
2. Despues de poner las dependencias en necesario sincronizar `maven` (icono üîÑÔ∏è)
:::

1. Crea la clase `Formulario.java` y pega el siguiente m√©todo `main`:



```java
public static void main(String[] args) throws Exception {
        OkHttpClient client = new OkHttpClient();

        // 1. Ruta de la imagen en disco
        Path imagen = Path.of("ruta a la imagen");

        // 2. Convertir la imagen a Base64 y prepararla para OCR.space
        String base64 = Base64.getEncoder()
                .encodeToString(Files.readAllBytes(imagen))
                .replaceAll("\\r|\\n", ""); // limpiar saltos de l√≠nea
        String base64Image = "data:image/png;base64," + base64;
        String encodedImage = URLEncoder.encode(base64Image, StandardCharsets.UTF_8);

        // 3. Construir el cuerpo del POST para OCR.space
        String body = "apikey=APIKEY"
                + "&language=spa"
                + "&OCREngine=2"
                + "&isOverlayRequired=true"
                + "&scale=true"
                + "&base64Image=" + encodedImage;

        // 4. Crear la petici√≥n HTTP a OCR.space
        Request request = new Request.Builder()
                .url("https://api.ocr.space/parse/image")
                .post(RequestBody.create(body, MediaType.parse("application/x-www-form-urlencoded")))
                .build();

        // 5. Ejecutar la petici√≥n y obtener la respuesta
        try (Response response = client.newCall(request).execute()) {
            String responseBody = response.body().string();
            System.out.println("Respuesta OCR: " + responseBody);

            // 6. Parsear JSON con el texto reconocido
            JSONObject json = new JSONObject(responseBody);
            JSONArray results = json.getJSONArray("ParsedResults");

            if (results.length() > 0) {
                // Texto plano devuelto por OCR.space
                String parsedText = results.getJSONObject(0).getString("ParsedText");
                String[] lines = parsedText.split("\\r?\\n");

                // 7. Extraer nombre, lugar y detalle (seg√∫n la posici√≥n en el texto)
                String nombre = lines[2].trim();
                String lugar = lines[4].trim();
                String detalle = lines[6].trim();

                System.out.println("Nombre: " + nombre);
                System.out.println("Lugar: " + lugar);
                System.out.println("Detalle: " + detalle);

                // 8. Construir JSON de salida para enviarlo a n8n
                JSONObject salida = new JSONObject();
                salida.put("nombre", nombre);
                salida.put("lugar", lugar);
                salida.put("detalle", detalle);

                // 9. Crear request hacia el webhook de n8n
                RequestBody body2 = RequestBody.create(
                        salida.toString(),
                        MediaType.parse("application/json; charset=utf-8")
                );

                Request request2 = new Request.Builder()
                        .url("http://localhost:5678/webhook/registrar")
                        .post(body2)
                        .build();

                // 10. Enviar JSON al webhook
                try (Response response2 = client.newCall(request2).execute()) {
                    System.out.println("C√≥digo respuesta: " + response2.code());
                    System.out.println("Respuesta n8n: " + response2.body().string());
                }
            } else {
                System.out.println("No se reconoci√≥ texto.");
            }

        }
    }
```
4. Entra en [https://api.ocr.space](https://api.ocr.space) y obt√©n un c√≥digo de **APIKEY**
5. Sustituye la ruta de la imagen por la tuya (descarga las del ejemplo), y la APIKEY
   
:::warning ATENCI√ìN
El tama√±o m√°ximo de la imagen debe ser de 1mb y en formano `.png`
:::


